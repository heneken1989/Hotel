@model IEnumerable<Hotel.Dtos.OrderViewDto>
@{
    ViewData["Title"] = "Index";
}


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thông tin  khách hàng</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div> <span>Số điện thoại</span> :<span class="cs_de-phone"></span> </div>
                <div> <span>Tên khách hàng</span> :<span class="cs_de-name"></span> </div>
                <div> <span>Ngày Check in</span> :<span class="cs_de-day"></span> </div>
            </div>
            <div class="modal-footer">
                <button type="button" onClick=updateOrder() data-id="" class="btn btn-success btn_update-order" data-dismiss="modal">Đóng</button>
               
            </div>
        </div>
    </div>
</div>

<h1 class="mb-3 text-center">Quản thông tin đặt phòng </h1>
<div class="container" style="min-height:100vh;background-color:white;box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px; padding:1rem;padding-bottom:1rem">

   

    <table id="room_table" class="table table-hover table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
               
               
                <th class="text-center">Loại phòng</th>
                <th class="text-center">Message</th>
                <th class="text-center">Ngày Order</th>
                <th class="text-center">Hành động</th>

            </tr>
        </thead>
        <tbody>
            @if (Model != null)
            {
                foreach (var item in Model)
                {
                    var isView = item.Isviewed==false ? "alert alert-warning" : "";
                    <tr  >
                      
                        <td class="text-center @isView">@Html.DisplayFor(a=>item.RoomType)</td>
                        <td class="text-center @isView">@Html.DisplayFor(a=>item.Message)</td>
                        <td class="text-center @isView">@Html.DisplayFor(a=>item.Date)</td>
                        <td onClick="showDetail('@item.OrderId','@item.Name','@item.Phone','@item.CheckInDate')"
                            class="text-center h6 @isView" data-toggle="modal" data-target="#exampleModal" style="cursor:pointer">
                            Xem thông tin khách hàng
                        </td>

                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<script>

    const convert=(data)=>{
        var parts = data.split(" ");
        var datePart = parts[0];
        var timePart = parts[1];

        // Split the date into day, month, and year
        var dateParts = datePart.split("/");
        var month = dateParts[0];
        var day = dateParts[1];
        var year = dateParts[2];

        // Reformat the date string in dd/mm/yyyy format
        var formattedDate = `ngày ${day}/${month}/${year}`;
        return formattedDate
    }
    const showDetail = (id,name,phone,days) => {


        $(".cs_de-phone").text(phone)
        $(".cs_de-name").text(name)
        $(".cs_de-day").text(convert(days))
      
        $(".btn_update-order").attr("data-id", id)
    }

    const updateOrder = () => {
        let id = $(".btn_update-order").attr("data-id")
     
        $.post(
        `/admin/order/update?id=${id}`,
            { id: id }, () => {
                $(document).ready(function () {
                    let tem = localStorage.getItem('tempTimes')
                    localStorage.setItem('orderTimes',tem)
                    location.reload(true);
                });
            }
           
        );
    }
</script>


